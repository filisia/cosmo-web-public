<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cosmo Bridge Developer Documentation</title>
    <link rel="stylesheet" href="documentation.css">
</head>
<body>
    <div class="progress-bar" id="progressBar"></div>
    <div class="container">
        <!-- Sidebar with TOC -->
        <div class="sidebar">
            <!-- Back Button -->
            <a href="/" class="back-button">Back to Cosmo Bridge</a>
            
            <!-- Table of Contents -->
            <div class="toc">
                <h2>üìã Table of Contents</h2>
                <ul>
                    <li><a href="#overview">1. Overview & Live Demo</a></li>
                    <li><a href="#bridge-applications">2. Bridge Applications</a></li>
                    <li><a href="#web-development-guide">3. Web Development</a></li>
                    <li><a href="#code-samples">4. Code Samples</a></li>
                    <li><a href="#installation-deployment">5. Installation & Deployment</a></li>
                    <li><a href="#websocket-api-reference">6. WebSocket API Reference</a></li>
                    <li><a href="#troubleshooting">7. Troubleshooting</a></li>
                    <li><a href="#getting-started-checklist">8. Distribution Checklist</a></li>
                </ul>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <h1>
                    <span class="cosmo-icon"></span>
                    <span class="cosmo-icon"></span>
                    Cosmo Bridge Developer Documentation
                    <span class="cosmo-icon"></span>
                    <span class="cosmo-icon"></span>
                </h1>
                <div class="subtitle">Complete Integration Guide for Web Applications</div>
                <div class="version-info">
                    <span><strong>Version:</strong> 1.0</span>
                    <span><strong>Date:</strong> September 2025</span>
                    <span><strong>Platform:</strong> Cosmo Bridge Ecosystem</span>
                </div>
            </div>

        <!-- Overview -->
        <h1 id="overview">üéØ Overview & Live Demo</h1>
        
        <p>The Cosmo Bridge ecosystem enables web applications to interact with Cosmo BLE devices through a WebSocket bridge application. This documentation provides developers with everything needed to build interactive applications and games that interface with Cosmo devices.</p>

        <div class="architecture">
            <div class="architecture-box">Web Applications<br/>(Your App)</div>
            <span class="architecture-arrow">‚Üê‚Üí</span>
            <div class="architecture-box">Bridge App<br/>(Win/Mac)</div>
            <span class="architecture-arrow">‚Üê‚Üí</span>
            <div class="architecture-box">Cosmo Devices<br/>(Hardware)</div>
            <br/>
            <div style="margin-top: 8px; color: var(--cosmo-blue);">
                WebSocket: ws://localhost:8080 &nbsp;&nbsp;&nbsp; BLE Communication
            </div>
        </div>

        <div class="benefits">
            <h3>üöÄ Key Benefits</h3>
            <ul>
                <li><strong>Cross-platform:</strong> Works on Windows and Mac</li>
                <li><strong>Real-time communication:</strong> &lt;50ms button response time</li>
                <li><strong>Multi-device support:</strong> Handle multiple Cosmo devices simultaneously</li>
                <li><strong>Web-based games:</strong> Deploy games via web browsers</li>
                <li><strong>Production ready:</strong> Extensively tested and validated</li>
            </ul>
        </div>

        <!-- Live Demo Section -->
        <div class="success-box">
            <h3>üåê Live Demo Available</h3>
            <p>Experience the Cosmo Bridge web application in action at:</p>
            <p style="text-align: center; margin: 15px 0;">
                <a href="https://bridge.explorecosmo.com/" target="_blank" 
                   style="color: var(--cosmo-purple); font-weight: 600; font-size: 16px; text-decoration: none; 
                          background: white; padding: 10px 20px; border-radius: 8px; border: 2px solid var(--cosmo-purple);">
                    https://bridge.explorecosmo.com/
                </a>
            </p>
            
            <h4>üè† Main Application Features:</h4>
            <ul>
                <li><strong>Bridge Connection Status:</strong> Real-time WebSocket connection indicator</li>
                <li><strong>Device Discovery:</strong> Automatic detection of nearby Cosmo devices</li>
                <li><strong>Device Management:</strong> View serial numbers, firmware versions, battery levels, and connection status</li>
                <li><strong>Platform Support:</strong> Download links for Windows and Mac bridge installers</li>
                <li><strong>Test Activity Launcher:</strong> Quick access to interactive exercise games</li>
            </ul>
            
            <h4>üéÆ Exercise Settings & Test Activity:</h4>
            <p>Try the interactive test activity at: <a href="https://bridge.explorecosmo.com/exercise-settings" target="_blank" style="color: var(--cosmo-purple); font-weight: 500;">https://bridge.explorecosmo.com/exercise-settings</a></p>
            
            <p><strong>Test Activity Features:</strong></p>
            <ul>
                <li><strong>Game Description:</strong> "Distribute the Cosmoids across the play area and swiftly press them as they illuminate to earn points before time runs out"</li>
                <li><strong>Duration Settings:</strong> Choose from 30 seconds, 1 minute, 2 minutes, or infinite play time</li>
                <li><strong>Music Options:</strong> Multiple background tracks including BrassBeat, Chill, and Upbeat styles</li>
                <li><strong>Audio Controls:</strong> Volume slider (0-100%) with visual mute indicator</li>
                <li><strong>Sound Toggle:</strong> Enable/disable sound effects with visual feedback</li>
                <li><strong>Device Indicators:</strong> Shows 6 cosmoid circles representing connected devices</li>
                <li><strong>Ready-to-Play:</strong> Launches interactive exercise when bridge and devices are connected</li>
            </ul>
            
            <div class="warning-box" style="margin-top: 15px;">
                <h4>üìù Note for Testing</h4>
                <p>To fully experience the interactive features, you'll need:</p>
                <ul>
                    <li>The Cosmo Bridge application installed and running locally</li>
                    <li>One or more Cosmo devices powered on and connected</li>
                    <li>A modern web browser (Chrome or Edge recommended)</li>
                </ul>
                <p><strong>Without the bridge:</strong> The web application will show "Bridge: Disconnected" and demonstrate the user interface, but interactive device features won't be available.</p>
            </div>
        </div>

        <!-- Bridge Applications -->
        <h1 id="bridge-applications">üñ•Ô∏è Bridge Applications</h1>

        <h2>Windows Bridge Application</h2>
        
        <div class="info-box">
            <h4>System Requirements</h4>
            <ul>
                <li>Windows 10/11 with Bluetooth Low Energy support</li>
                <li>Bluetooth adapter (built-in or USB)</li>
                <li>Administrator privileges (required for BLE operations)</li>
            </ul>
        </div>

        <div class="success-box">
            <h4>üì¶ Installation for End Users</h4>
            <ol class="installation-steps">
                <li>Download <code>CosmoBridge-Windows-Setup.exe</code> installer</li>
                <li>Right-click installer and select "Run as Administrator"</li>
                <li>Follow the installation wizard</li>
                <li>Grant Bluetooth permissions when prompted</li>
                <li>Launch "Cosmo Bridge" from the Start Menu or Desktop</li>
            </ol>
        </div>

        <h2>Mac Bridge Application</h2>
        
        <div class="info-box">
            <h4>System Requirements</h4>
            <ul>
                <li>macOS 10.15 (Catalina) or newer</li>
                <li>Built-in Bluetooth or compatible Bluetooth adapter</li>
                <li>Bluetooth permissions for the application</li>
            </ul>
        </div>

        <div class="success-box">
            <h4>üì¶ Installation for End Users</h4>
            <ol class="installation-steps">
                <li>Download <code>CosmoBridge-Mac-Setup.dmg</code> installer</li>
                <li>Open the <code>.dmg</code> file</li>
                <li>Drag "Cosmo Bridge" to the Applications folder</li>
                <li>Launch from Applications folder</li>
                <li>Grant Bluetooth permissions in System Preferences when prompted</li>
            </ol>
        </div>

        <!-- Web Development Guide -->
        <h1 id="web-development-guide">üíª Web Development</h1>
        
        <p>This guide walks you through building a React app with Cosmo Bridge, step by step using real code from our working implementation.</p>

        <h2>Step 1: Connect to Cosmo Bridge</h2>
        <p>First, establish a WebSocket connection to get access to connected Cosmo devices. We use React Context to manage the connection state.</p>
        
        <div class="api-box">
            <h4>From ExerciseSettings.js - Getting Connected Devices</h4>
            <pre><code>import { useWebSocket } from '../contexts/WebSocketContext';

export default function ExerciseSettings() {
  // Get connected devices from WebSocket context
  const { connectedDevices } = useWebSocket();
  const numCosmos = connectedDevices.length;
  
  console.log(`Found ${numCosmos} connected devices:`, connectedDevices);
  
  // Each device object contains:
  // {
  //   id: "device-uuid-string",
  //   name: "Cosmo Device", 
  //   serial: "2405002009",
  //   batteryLevel: 85,
  //   connected: true
  // }
}</code></pre>
        </div>
        
        <div class="info-box">
            <p><strong>üí° What's happening:</strong> The <code>useWebSocket</code> hook automatically connects to <code>ws://localhost:8080</code> and provides real-time access to connected Cosmo devices. No manual WebSocket management needed!</p>
        </div>

        <h2>Step 2: Display Device Connection Status</h2>
        <p>Show users which devices are connected with visual indicators that update in real-time.</p>
        
        <div class="api-box">
            <h4>From ExerciseSettings.js - Device Indicators</h4>
            <pre><code>// Show 6 potential device slots, but only enable connected ones
const renderDeviceIndicators = () => {
  return (
    &lt;div className="flex gap-2"&gt;
      {Array.from({ length: 6 }, (_, index) => {
        const i = index + 1;
        const isEnabled = index < numCosmos; // Only enabled if device is connected
        
        // Real color scheme from our app
        const colors = [
          { bg: '#E3F2FD', border: '#2196F3', text: '#2196F3' }, // blue
          { bg: '#E8F5E8', border: '#4CAF50', text: '#4CAF50' }, // green  
          { bg: '#FFF9E1', border: '#FFC107', text: '#FFC107' }, // yellow
          { bg: '#FFF3E0', border: '#FF9800', text: '#FF9800' }, // orange
          { bg: '#FFEBEE', border: '#F44336', text: '#F44336' }, // red
          { bg: '#F3E5F5', border: '#9C27B0', text: '#9C27B0' }  // purple
        ];
        
        const colorIndex = index % colors.length;
        const { bg, border, text } = colors[colorIndex];
        
        return (
          &lt;div
            key={i}
            style={{
              width: '40px', height: '40px',
              backgroundColor: isEnabled ? bg : '#F5F5F5', // Gray when disconnected
              border: `1px solid ${isEnabled ? border : '#D9D9D9'}`,
              color: isEnabled ? text : '#9E9E9E',
              opacity: isEnabled ? 1 : 0.5 // Semi-transparent when disabled
            }}
          &gt;
            {i}
          &lt;/div&gt;
        );
      })}
    &lt;/div&gt;
  );
};</code></pre>
        </div>
        
        <div class="info-box">
            <p><strong>üí° What's happening:</strong> This creates a visual representation showing up to 6 device slots. Connected devices appear in color, while disconnected slots are grayed out. The UI updates automatically as devices connect/disconnect.</p>
        </div>

        <h2>Step 3: Control Device Colors and Lighting</h2>
        <p>Use the WebSocket service to send commands to your connected devices. Set colors and brightness levels.</p>
        
        <div class="api-box">
            <h4>From ExerciseGame.js - Device Control</h4>
            <pre><code>import wsService from '../services/WebSocketService';

// Define colors for each device (RGB values 0-4 for Cosmo devices)
const colorMap = [
  { name: 'blue', rgb: [0, 0, 4] },
  { name: 'green', rgb: [0, 4, 0] },  
  { name: 'yellow', rgb: [4, 3, 0] },
  { name: 'orange', rgb: [4, 1, 0] },
  { name: 'red', rgb: [4, 0, 0] },
  { name: 'purple', rgb: [4, 0, 4] },
];

// Initialize each device with its assigned color
const initializeDevices = () => {
  cosmosToUse.forEach((device, idx) => {
    console.log(`Setting up device ${device.id} (index ${idx})`);
    const [r, g, b] = colorMap[idx % colorMap.length].rgb;
    
    // Set the device color and start with lights off
    wsService.setColor(device.id, r, g, b);
    wsService.setLuminosity(device.id, 0); // 0 = off, 64 = bright
  });
};

// Light up specific devices during gameplay
const updateDeviceLighting = (activeIndex) => {
  cosmosToUse.forEach((device, idx) => {
    const shouldBeLit = idx === activeIndex;
    const luminosity = shouldBeLit ? 64 : 0;
    
    wsService.setLuminosity(device.id, luminosity);
  });
};</code></pre>
        </div>
        
        <div class="info-box">
            <p><strong>üí° What's happening:</strong> <code>wsService.setColor()</code> sets the RGB color (values 0-4), and <code>wsService.setLuminosity()</code> controls brightness (0-64). Commands are sent immediately via WebSocket.</p>
        </div>

        <h2>Step 4: Handle Button Press Events</h2>
        <p>Listen for button presses and respond with proper debouncing to prevent multiple triggers.</p>
        
        <div class="api-box">
            <h4>From ExerciseGame.js - Button Event Handling</h4>
            <pre><code>// Get real-time device data including button states
const { connectedDevices, deviceValues } = useWebSocket();

// Handle button press with game logic
const handleButtonPress = useCallback((deviceId) => {
  console.log(`Button pressed on device: ${deviceId}`);
  
  // Your game logic here - check if correct device was pressed
  if (deviceId === activeDevice.id) {
    console.log('Correct button pressed!');
    setScore(s => s + 1);
    // Move to next device
    setActiveIndex(i => (i + 1) % cosmosToUse.length);
  }
}, [activeDevice, cosmosToUse]);

// Monitor button state changes with debouncing
const checkButtonStates = useCallback(() => {
  if (!activeDevice || !deviceValues[activeDevice.id]) return;
  
  const deviceValue = deviceValues[activeDevice.id];
  const currentButtonState = deviceValue.buttonState; // 0 = released, 1 = pressed
  const previousButtonState = previousButtonStates.current[activeDevice.id];
  
  // Detect button press (transition from released to pressed)
  const wasReleased = previousButtonState === 0;
  const isPressed = currentButtonState === 1;
  
  if (wasReleased && isPressed) {
    // Debounce: only allow one press per 500ms
    const now = Date.now();
    if (!lastPressRef.current[activeDevice.id] || 
        now - lastPressRef.current[activeDevice.id] > 500) {
      lastPressRef.current[activeDevice.id] = now;
      handleButtonPress(activeDevice.id);
    }
  }
  
  // Remember current state for next check
  previousButtonStates.current[activeDevice.id] = currentButtonState;
}, [activeDevice, deviceValues, handleButtonPress]);

// Check button states when device values change
useEffect(() => {
  if (activeDevice && deviceValues[activeDevice.id]) {
    checkButtonStates();
  }
}, [deviceValues, activeDevice, checkButtonStates]);</code></pre>
        </div>
        
        <div class="info-box">
            <p><strong>üí° What's happening:</strong> <code>deviceValues</code> contains real-time data from all devices. We monitor <code>buttonState</code> changes and use debouncing (500ms) to prevent accidental double-presses. Button state: 0 = released, 1 = pressed.</p>
        </div>

        <h2>Step 5: Build Your Complete Component</h2>
        <p>Put it all together in a React component that manages device state, handles events, and updates the UI.</p>
        
        <div class="api-box">
            <h4>Complete React Component Pattern</h4>
            <pre><code>import React, { useState, useEffect, useMemo, useCallback, useRef } from 'react';
import { useWebSocket } from '../contexts/WebSocketContext';
import wsService from '../services/WebSocketService';

export default function MyCosmosGame() {
  // 1. Get WebSocket connection and device data
  const { connectedDevices, deviceValues } = useWebSocket();
  
  // 2. Component state
  const [activeIndex, setActiveIndex] = useState(0);
  const [score, setScore] = useState(0);
  const [gameStarted, setGameStarted] = useState(false);
  
  // 3. Get devices to use (limit to available devices)
  const devicesToUse = useMemo(() => 
    connectedDevices.slice(0, 3), [connectedDevices]);
  
  const activeDevice = devicesToUse[activeIndex];
  
  // 4. Initialize devices when component mounts
  useEffect(() => {
    if (devicesToUse.length > 0) {
      devicesToUse.forEach((device, idx) => {
        const colors = [[4,0,0], [0,4,0], [0,0,4]]; // Red, Green, Blue
        const [r, g, b] = colors[idx % colors.length];
        
        wsService.setColor(device.id, r, g, b);
        wsService.setLuminosity(device.id, 0);
      });
      setGameStarted(true);
    }
  }, [devicesToUse]);
  
  // 5. Update lighting when active device changes
  useEffect(() => {
    if (gameStarted && devicesToUse.length > 0) {
      devicesToUse.forEach((device, idx) => {
        const luminosity = idx === activeIndex ? 64 : 0;
        wsService.setLuminosity(device.id, luminosity);
      });
    }
  }, [activeIndex, gameStarted, devicesToUse]);
  
  // 6. Handle button presses
  const handleButtonPress = useCallback((deviceId) => {
    if (deviceId === activeDevice?.id) {
      setScore(s => s + 1);
      setActiveIndex(i => (i + 1) % devicesToUse.length);
    }
  }, [activeDevice, devicesToUse]);
  
  // 7. Monitor button states (simplified version)
  useEffect(() => {
    if (!activeDevice || !deviceValues[activeDevice.id]) return;
    
    const checkButton = () => {
      const deviceValue = deviceValues[activeDevice.id];
      if (deviceValue.buttonState === 1) { // Pressed
        handleButtonPress(activeDevice.id);
      }
    };
    
    const interval = setInterval(checkButton, 100);
    return () => clearInterval(interval);
  }, [activeDevice, deviceValues, handleButtonPress]);
  
  // 8. Render your game UI
  return (
    &lt;div className="game-container"&gt;
      &lt;h1&gt;Score: {score}&lt;/h1&gt;
      &lt;p&gt;Press the lit-up device!&lt;/p&gt;
      
      &lt;div className="devices"&gt;
        {devicesToUse.map((device, idx) =&gt; (
          &lt;div 
            key={device.id}
            className={idx === activeIndex ? 'device active' : 'device'}
          &gt;
            Device {idx + 1}
          &lt;/div&gt;
        ))}
      &lt;/div&gt;
    &lt;/div&gt;
  );
}</code></pre>
        </div>
        
        <div class="success-box">
            <h4>üéâ You're Ready!</h4>
            <p>This complete example shows how to:</p>
            <ul>
                <li><strong>Connect</strong> to Cosmo Bridge automatically</li>
                <li><strong>Control</strong> device colors and lighting</li>
                <li><strong>Handle</strong> button press events</li>
                <li><strong>Build</strong> interactive games and experiences</li>
            </ul>
            <p>Modify the game logic, colors, and UI to create your own unique Cosmo experience!</p>
        </div>

        <h2>Next Steps</h2>
        <div class="info-box">
            <p><strong>üöÄ Ready to build your own?</strong></p>
            <ul>
                <li>Copy the complete component above as your starting point</li>
                <li>Modify the game logic for your use case</li>
                <li>Add your own UI styling and animations</li>
                <li>Test with real Cosmo devices connected via the bridge</li>
                <li>Deploy your web app to any hosting service</li>
            </ul>
        </div>

        <!-- Code Samples -->
        <h1 id="code-samples">üìã Code Samples</h1>
        
        <p>Complete code examples from our working Exercise app that you can copy and modify for your own projects.</p>

        <h2>Complete React Component</h2>
        <div class="api-box">
            <h4>ExerciseGame.js - Full Implementation</h4>
            <pre><code>import React, { useState, useEffect, useMemo, useCallback, useRef } from 'react';
import { useWebSocket } from '../contexts/WebSocketContext';
import wsService from '../services/WebSocketService';

export default function ExerciseGame() {
  const { connectedDevices, deviceValues } = useWebSocket();
  const [gameStarted, setGameStarted] = useState(false);
  const [activeIndex, setActiveIndex] = useState(0);
  const [score, setScore] = useState(0);
  const [timeLeft, setTimeLeft] = useState(60);
  const [gameRunning, setGameRunning] = useState(false);

  // Game state refs
  const previousButtonStates = useRef({});
  const lastPressRef = useRef({});
  const gameTimerRef = useRef(null);

  // Color mapping for devices
  const colorMap = [
    { name: 'blue', rgb: [0, 0, 4] },
    { name: 'green', rgb: [0, 4, 0] },
    { name: 'yellow', rgb: [4, 3, 0] },
    { name: 'orange', rgb: [4, 1, 0] },
    { name: 'red', rgb: [4, 0, 0] },
    { name: 'purple', rgb: [4, 0, 4] },
  ];

  // Get devices to use for the game
  const cosmosToUse = useMemo(() => {
    return connectedDevices.slice(0, Math.min(6, connectedDevices.length));
  }, [connectedDevices]);

  const activeDevice = cosmosToUse[activeIndex];

  // Initialize devices
  const initializeDevices = useCallback(() => {
    cosmosToUse.forEach((device, idx) => {
      const [r, g, b] = colorMap[idx % colorMap.length].rgb;
      wsService.setColor(device.id, r, g, b);
      wsService.setLuminosity(device.id, 0);
      previousButtonStates.current[device.id] = 0;
    });
  }, [cosmosToUse]);

  // Update device lighting
  const updateDeviceLighting = useCallback(() => {
    cosmosToUse.forEach((device, idx) => {
      const luminosity = idx === activeIndex ? 64 : 0;
      wsService.setLuminosity(device.id, luminosity);
    });
  }, [cosmosToUse, activeIndex]);

  // Handle button press
  const handleButtonPress = useCallback((deviceId) => {
    if (deviceId === activeDevice?.id && gameRunning) {
      setScore(s => s + 1);
      setActiveIndex(i => (i + 1) % cosmosToUse.length);
      
      // Show visual feedback
      const device = cosmosToUse.find(d => d.id === deviceId);
      if (device) {
        const idx = cosmosToUse.indexOf(device);
        const [r, g, b] = colorMap[idx % colorMap.length].rgb;
        wsService.setColor(device.id, r, g, b);
      }
    }
  }, [activeDevice, gameRunning, cosmosToUse]);

  // Check button states with debouncing
  const checkButtonStates = useCallback(() => {
    if (!activeDevice || !deviceValues[activeDevice.id] || !gameRunning) return;

    const deviceValue = deviceValues[activeDevice.id];
    const currentButtonState = deviceValue.buttonState;
    const previousButtonState = previousButtonStates.current[activeDevice.id];

    const wasReleased = previousButtonState === 0;
    const isPressed = currentButtonState === 1;

    if (wasReleased && isPressed) {
      const now = Date.now();
      if (!lastPressRef.current[activeDevice.id] || 
          now - lastPressRef.current[activeDevice.id] > 500) {
        lastPressRef.current[activeDevice.id] = now;
        handleButtonPress(activeDevice.id);
      }
    }

    previousButtonStates.current[activeDevice.id] = currentButtonState;
  }, [activeDevice, deviceValues, gameRunning, handleButtonPress]);

  // Start game
  const startGame = () => {
    if (cosmosToUse.length === 0) return;
    
    setScore(0);
    setTimeLeft(60);
    setActiveIndex(0);
    setGameRunning(true);
    setGameStarted(true);
    
    initializeDevices();
    
    // Start game timer
    gameTimerRef.current = setInterval(() => {
      setTimeLeft(prev => {
        if (prev <= 1) {
          endGame();
          return 0;
        }
        return prev - 1;
      });
    }, 1000);
  };

  // End game
  const endGame = () => {
    setGameRunning(false);
    if (gameTimerRef.current) {
      clearInterval(gameTimerRef.current);
      gameTimerRef.current = null;
    }
    
    // Turn off all devices
    cosmosToUse.forEach(device => {
      wsService.setLuminosity(device.id, 0);
    });
  };

  // Effects
  useEffect(() => {
    if (gameStarted && gameRunning && cosmosToUse.length > 0) {
      updateDeviceLighting();
    }
  }, [gameStarted, gameRunning, updateDeviceLighting]);

  useEffect(() => {
    checkButtonStates();
  }, [checkButtonStates]);

  useEffect(() => {
    return () => {
      if (gameTimerRef.current) {
        clearInterval(gameTimerRef.current);
      }
    };
  }, []);

  return (
    &lt;div className="exercise-game"&gt;
      &lt;div className="game-header"&gt;
        &lt;h2&gt;Cosmo Exercise Game&lt;/h2&gt;
        &lt;div className="game-stats"&gt;
          &lt;div&gt;Score: {score}&lt;/div&gt;
          &lt;div&gt;Time: {timeLeft}s&lt;/div&gt;
          &lt;div&gt;Devices: {cosmosToUse.length}&lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;

      {!gameStarted ? (
        &lt;div className="game-start"&gt;
          &lt;p&gt;Connected devices: {cosmosToUse.length}&lt;/p&gt;
          &lt;button 
            onClick={startGame}
            disabled={cosmosToUse.length === 0}
          &gt;
            Start Exercise
          &lt;/button&gt;
        &lt;/div&gt;
      ) : (
        &lt;div className="game-active"&gt;
          {gameRunning ? (
            &lt;p&gt;Press the lit-up device!&lt;/p&gt;
          ) : (
            &lt;div&gt;
              &lt;p&gt;Game Over! Final score: {score}&lt;/p&gt;
              &lt;button onClick={startGame}&gt;Play Again&lt;/button&gt;
            &lt;/div&gt;
          )}
          
          &lt;div className="device-grid"&gt;
            {cosmosToUse.map((device, idx) =&gt; (
              &lt;div 
                key={device.id}
                className={`device-indicator ${idx === activeIndex ? 'active' : ''}`}
                style={{
                  backgroundColor: colorMap[idx % colorMap.length].name,
                  opacity: idx === activeIndex ? 1 : 0.3
                }}
              &gt;
                Device {idx + 1}
              &lt;/div&gt;
            ))}
          &lt;/div&gt;
        &lt;/div&gt;
      )}
    &lt;/div&gt;
  );
}</code></pre>
        </div>

        <!-- WebSocket API Reference -->
        <h1 id="websocket-api-reference">üîó WebSocket API Reference</h1>

        <div class="api-box">
            <h4>Connection</h4>
            <p><strong>Endpoint:</strong> <code>ws://localhost:8080</code></p>
            <pre><code>const ws = new WebSocket('ws://localhost:8080');

ws.onopen = () => {
  console.log('Connected to Cosmo Bridge');
  ws.send(JSON.stringify({ type: 'getDevices' }));
};</code></pre>
        </div>

        <h2>Complete API Reference</h2>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
            <!-- Left Column -->
            <div>
                <h3 style="margin-top: 0;">üì• Outgoing Messages (Your App ‚Üí Bridge)</h3>
                
                <div class="api-box">
                    <h4>Device Discovery</h4>
                    <pre><code>{ "type": "getDevices" }</code></pre>
                    <small>Get list of all connected devices</small>
                </div>
                
                <div class="api-box">
                    <h4>Device Color Control</h4>
                    <pre><code>{
  "type": "setColor",
  "deviceId": "device-uuid",
  "color": { "r": 255, "g": 0, "b": 128 }
}</code></pre>
                    <small>RGB values: 0-255 each</small>
                </div>
                
                <div class="api-box">
                    <h4>Device Brightness</h4>
                    <pre><code>{
  "type": "setLuminosity",
  "deviceId": "device-uuid",
  "data": [64]
}</code></pre>
                    <small>Intensity: 0-255 (0=off, 64=bright)</small>
                </div>
                
                <div class="api-box">
                    <h4>Device Mode</h4>
                    <pre><code>{
  "type": "setMode",
  "deviceId": "device-uuid",
  "data": [4]
}</code></pre>
                    <small>Set device operating mode</small>
                </div>
                
                <div class="api-box">
                    <h4>Device Locking</h4>
                    <pre><code>{
  "type": "lockDevices",
  "isLocked": true,
  "deviceIds": ["device-1", "device-2"]
}</code></pre>
                    <small>Prevent other apps from using devices</small>
                </div>
                
                
                <div class="api-box">
                    <h4>Request Device Scan</h4>
                    <pre><code>{
  "type": "requestScan",
  "duration": 10000
}</code></pre>
                    <small>Scan for new devices (duration in ms)</small>
                </div>
            </div>
            
            <!-- Right Column -->
            <div>
                <h3 style="margin-top: 0;">üì§ Incoming Messages (Bridge ‚Üí Your App)</h3>
                
                <div class="api-box">
                    <h4>Device List Response</h4>
                    <pre><code>{
  "type": "devices",
  "devices": [{
    "id": "device-uuid",
    "name": "Cosmo Device",
    "serial": "2405002009",
    "firmware": "4.6.00",
    "batteryLevel": 85,
    "connected": true,
    "buttonState": 0,
    "pressValue": 0,
    "color": [0, 0, 0],
    "luminosity": 0
  }]
}</code></pre>
                </div>
                
                <div class="api-box">
                    <h4>Button Press Event</h4>
                    <pre><code>{
  "type": "buttonPress",
  "deviceId": "device-uuid",
  "pressValue": 255
}</code></pre>
                    <small>Triggered when button is pressed</small>
                </div>
                
                <div class="api-box">
                    <h4>Button Release Event</h4>
                    <pre><code>{
  "type": "buttonRelease",
  "deviceId": "device-uuid",
  "pressValue": 0
}</code></pre>
                    <small>Triggered when button is released</small>
                </div>
                
                <div class="api-box">
                    <h4>Button State Change</h4>
                    <pre><code>{
  "type": "buttonStateChanged",
  "deviceId": "device-uuid",
  "buttonState": "pressed",
  "pressValue": 255
}</code></pre>
                    <small>General button state updates</small>
                </div>
                
                <div class="api-box">
                    <h4>Device Update</h4>
                    <pre><code>{
  "type": "deviceUpdate",
  "deviceId": "device-uuid",
  "batteryLevel": 82,
  "connected": true
}</code></pre>
                    <small>Real-time device status changes</small>
                </div>
                
                <div class="api-box">
                    <h4>Lock State Changed</h4>
                    <pre><code>{
  "type": "lockStateChanged",
  "isLocked": true,
  "deviceIds": ["device-1"]
}</code></pre>
                    <small>Device lock status update</small>
                </div>
                
                <div class="api-box">
                    <h4>Error Messages</h4>
                    <pre><code>{
  "type": "error",
  "message": "Device not found",
  "deviceId": "device-uuid"
}</code></pre>
                    <small>Error notifications</small>
                </div>
                
            </div>
        </div>
        
        <div class="api-box">
            <h4>üé® Color Reference</h4>
            <div style="display: flex; flex-wrap: wrap; gap: 15px; align-items: center;">
                <span><span class="color-demo color-red"></span> Red: {r: 255, g: 0, b: 0}</span>
                <span><span class="color-demo color-green"></span> Green: {r: 0, g: 255, b: 0}</span>
                <span><span class="color-demo color-blue"></span> Blue: {r: 0, g: 0, b: 255}</span>
                <span><span class="color-demo color-yellow"></span> Yellow: {r: 255, g: 255, b: 0}</span>
                <span><span class="color-demo color-purple"></span> Purple: {r: 255, g: 0, b: 255}</span>
                <span><span class="color-demo color-cyan"></span> Cyan: {r: 0, g: 255, b: 255}</span>
            </div>
        </div>

        <h2>Advanced Message Types</h2>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
            <div class="api-box">
                <h4>Characteristic Value Changed</h4>
                <pre><code>{
  "type": "characteristicValueChanged",
  "deviceId": "device-uuid",
  "characteristic": "button",
  "value": [1]
}</code></pre>
                <small>Raw BLE characteristic updates</small>
            </div>
            
            <div class="api-box">
                <h4>Connection State Changes</h4>
                <pre><code>{
  "type": "deviceConnectionChanged",
  "deviceId": "device-uuid",
  "connected": true,
  "timestamp": "2025-09-03T10:30:00.000Z"
}</code></pre>
                <small>Device connection/disconnection events</small>
            </div>
        </div>
        
        <div class="info-box">
            <h4>üìù Message Type Summary</h4>
            <p><strong>All Available Message Types:</strong></p>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <strong>Outgoing (Your App ‚Üí Bridge):</strong>
                    <ul style="margin: 5px 0; font-family: monospace; font-size: 13px;">
                        <li>getDevices</li>
                        <li>setColor</li>
                        <li>setLuminosity</li>
                        <li>setMode</li>
                        <li>lockDevices</li>
                        <li>requestScan</li>
                    </ul>
                </div>
                <div>
                    <strong>Incoming (Bridge ‚Üí Your App):</strong>
                    <ul style="margin: 5px 0; font-family: monospace; font-size: 13px;">
                        <li>devices</li>
                        <li>buttonPress</li>
                        <li>buttonRelease</li>
                        <li>buttonStateChanged</li>
                        <li>deviceUpdate</li>
                        <li>lockStateChanged</li>
                        <li>error</li>
                        <li>characteristicValueChanged</li>
                        <li>deviceConnectionChanged</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="warning-box">
            <h4>‚ö° Performance Guidelines</h4>
            <ul>
                <li><strong>Rate Limiting:</strong> Maximum 10 messages/second per device</li>
                <li><strong>Button Response:</strong> &lt;50ms from WebSocket message to UI update</li>
                <li><strong>Multi-device:</strong> Tested with 6+ simultaneous connections</li>
                <li><strong>Error Handling:</strong> Always validate message structure before processing</li>
            </ul>
        </div>

        <div class="success-box">
            <h4>üöÄ Quick Start</h4>
            <pre><code>const ws = new WebSocket('ws://localhost:8080');

ws.onopen = () => {
  console.log('Connected to Cosmo Bridge');
  ws.send(JSON.stringify({ type: 'getDevices' }));
};

ws.onmessage = (event) => {
  const message = JSON.parse(event.data);
  
  switch (message.type) {
    case 'devices':
      console.log('Connected devices:', message.devices);
      break;
    case 'buttonPress':
      console.log(`Button pressed on device: ${message.deviceId}`);
      break;
  }
};</code></pre>
        </div>

        <!-- Installation & Deployment -->
        <h1 id="installation-deployment">üì¶ Installation & Deployment</h1>

        <div class="success-box">
            <h3>For Web Developers</h3>
            <ul>
                <li>No installation required - develop in any web browser</li>
                <li>Connect to bridge via <code>ws://localhost:8080</code></li>
                <li>Deploy web games to any hosting service (Vercel, Netlify, GitHub Pages, etc.)</li>
                <li>End users run the bridge locally, access games from any web URL</li>
            </ul>
        </div>

        <div class="info-box">
            <h4>üìã Distribution Model</h4>
            <ul>
                <li><strong>Developers distribute:</strong> Bridge installers to their customers</li>
                <li><strong>Developers create:</strong> Web applications using provided API and examples</li>
                <li><strong>End users install:</strong> Bridge app once, then access multiple web applications</li>
                <li><strong>Applications hosted:</strong> Anywhere on the web, connect to local bridge automatically</li>
            </ul>
            
            <h4>üåü Live Reference Implementation</h4>
            <p>The Cosmo Bridge web application at <a href="https://bridge.explorecosmo.com/" target="_blank" style="color: var(--cosmo-purple); font-weight: 500;">https://bridge.explorecosmo.com/</a> serves as a complete reference implementation showing:</p>
            <ul>
                <li><strong>Professional UI/UX design</strong> with Cosmo branding and styling</li>
                <li><strong>Robust WebSocket integration</strong> with connection status and error handling</li>
                <li><strong>Multi-device management</strong> displaying device information and status</li>
                <li><strong>Interactive game implementation</strong> with settings, audio controls, and real-time feedback</li>
            </ul>
        </div>

        <!-- Troubleshooting -->
        <h1 id="troubleshooting">üîß Troubleshooting</h1>

        <div class="warning-box">
            <h4>Connection Problems</h4>
            <p><strong>Issue:</strong> Cannot connect to WebSocket</p>
            <p><strong>Solution:</strong></p>
            <ul>
                <li>Ensure bridge application is running</li>
                <li>Check that port 8080 is not blocked by firewall</li>
                <li>Verify WebSocket URL is <code>ws://localhost:8080</code></li>
            </ul>
        </div>

        <div class="api-box">
            <h4>Health Check Commands</h4>
            <pre><code>// Check bridge connectivity
const healthCheck = () => {
  const ws = new WebSocket('ws://localhost:8080');
  ws.onopen = () => {
    console.log('‚úì Bridge connection successful');
    // Connection established
  };
  ws.onerror = () => {
    console.log('‚úó Bridge connection failed');
  };
};</code></pre>
        </div>

        <!-- Getting Started Checklist -->
        <h1 id="getting-started-checklist">‚úÖ Distribution Checklist</h1>

        <div class="checklist">
            <h3>Step 1: Distribute Bridge to Your Users</h3>
            <ul>
                <li>Provide users with appropriate installer (<code>CosmoBridge-Windows-Setup.exe</code> or <code>CosmoBridge-Mac-Setup.dmg</code>)</li>
                <li>Include installation instructions</li>
                <li>Ensure users understand they need Administrator/Bluetooth permissions</li>
            </ul>
        </div>

        <div class="checklist">
            <h3>Step 2: Develop Your Web Games</h3>
            <ul>
                <li>Use the provided code samples as starting points</li>
                <li>Test with bridge running locally (<code>ws://localhost:8080</code>)</li>
                <li>Implement error handling for connection issues</li>
                <li>Test with multiple Cosmo devices if needed</li>
            </ul>
        </div>

        <div class="success-box">
            <h3>Step 3: User Experience</h3>
            <ol class="installation-steps">
                <li><strong>User installs bridge</strong> (one-time setup)</li>
                <li><strong>User launches bridge</strong> (starts WebSocket server)</li>
                <li><strong>User visits your web game</strong> (any URL)</li>
                <li><strong>Game connects automatically</strong> to local bridge</li>
                <li><strong>User plays with Cosmo devices</strong> seamlessly</li>
            </ol>
            
            <h4>üéØ Experience the Complete Flow</h4>
            <p>See this entire user experience in action by visiting <a href="https://bridge.explorecosmo.com/" target="_blank" style="color: var(--cosmo-purple); font-weight: 500;">https://bridge.explorecosmo.com/</a> with the bridge application running. The live demo shows exactly what your users will experience when using applications built with the Cosmo Bridge ecosystem.</p>
        </div>

        </div>
    </div>
    
    <script>
        // Progress bar functionality
        window.addEventListener('scroll', () => {
            const scrollTop = document.documentElement.scrollTop;
            const scrollHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
            const scrolled = (scrollTop / scrollHeight) * 100;
            document.getElementById('progressBar').style.width = scrolled + '%';
            
            // Add scrolled class to TOC for blur effect
            const toc = document.querySelector('.toc');
            if (scrollTop > 100) {
                toc.classList.add('scrolled');
            } else {
                toc.classList.remove('scrolled');
            }
        });
        
        // Smooth scroll for anchor links
        document.querySelectorAll('.toc a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
        
        // Highlight current section in TOC
        const observerOptions = {
            root: null,
            rootMargin: '-20% 0px -70% 0px',
            threshold: 0
        };
        
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                const id = entry.target.getAttribute('id');
                const tocLink = document.querySelector(`.toc a[href="#${id}"]`);
                if (tocLink) {
                    if (entry.isIntersecting) {
                        document.querySelectorAll('.toc a').forEach(link => {
                            link.style.color = 'var(--cosmo-gray)';
                            link.style.fontWeight = '500';
                        });
                        tocLink.style.color = 'var(--cosmo-purple)';
                        tocLink.style.fontWeight = '700';
                    }
                }
            });
        }, observerOptions);
        
        // Observe all sections
        document.querySelectorAll('h1[id]').forEach(section => {
            observer.observe(section);
        });

        // Copy Code Functionality
        function addCopyButtons() {
            const codeBlocks = document.querySelectorAll('pre');
            
            codeBlocks.forEach(pre => {
                // Skip if button already exists
                if (pre.querySelector('.copy-btn')) return;
                
                const copyBtn = document.createElement('button');
                copyBtn.className = 'copy-btn';
                copyBtn.textContent = 'Copy';
                
                copyBtn.addEventListener('click', async () => {
                    const code = pre.querySelector('code') || pre;
                    const text = code.textContent;
                    
                    try {
                        await navigator.clipboard.writeText(text);
                        copyBtn.textContent = 'Copied!';
                        copyBtn.classList.add('copied');
                        
                        setTimeout(() => {
                            copyBtn.textContent = 'Copy';
                            copyBtn.classList.remove('copied');
                        }, 2000);
                    } catch (err) {
                        // Fallback for older browsers
                        const textArea = document.createElement('textarea');
                        textArea.value = text;
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);
                        
                        copyBtn.textContent = 'Copied!';
                        copyBtn.classList.add('copied');
                        
                        setTimeout(() => {
                            copyBtn.textContent = 'Copy';
                            copyBtn.classList.remove('copied');
                        }, 2000);
                    }
                });
                
                pre.appendChild(copyBtn);
            });
        }
        
        // Add copy buttons when page loads
        addCopyButtons();
    </script>
</body>
</html>